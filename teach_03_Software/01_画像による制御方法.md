# 画像による制御方法

ここでは、Raspberry Pi Camera と、Raspberry Pi Zero を使った方法をご紹介します。

## 手順

1. 画像を撮影する
2. コーンの色のみを抽出する
3. 抽出した画像をグレースケール化する
4. グレースケール化した画像を 2 値化する
5. 2 値化する画像の中心座標を求める
6. 中心座標をもとに CanSat を制御する
7. 1 に戻り繰り返す

### 1. 画像を撮影する

Raspberry Pi では、カメラを接続し、以下のコードを動かすことで画像を取得することができます。（カメラの接続方法、初期設定等は調べて実行してください。）

```
import picamera
import picamera.array

camera.start_preview()
camera.capture('image.jpg')
camera.stop_preview()
```

これを python で実行すると、"image.jpg"というファイルが保存されます。

画像を撮影し、それを Open CV で読み込むということを行ってもいいですが、それだと二度手間なので、撮影した画像データを直接 Open CV で読み込む方法も紹介します。

```
with picamera.PiCamera() as camera:
        with picamera.array.PiRGBArray(camera) as stream:
            self.savesign = (self.savesign + 1) % 5
            camera.resolution = self.resolution
            camera.framerate = self.framerate
            camera.capture(stream, 'bgr', use_video_port=True)
            image = stream.array
```

このようにすると、"image"という変数に読み込んだ画像データが格納されます。実際の完成コードではこの image というデータを使い画像の色抽出を行います。

### 2. コーンの色のみを抽出する

色抽出を行うコードは 1 つのファイルにまとめ、モジュールとして使えるようにした方が便利です。このファイルの import を以下に示します。

```
from matplotlib import image
import numpy as np
import cv2
from time import sleep
from PIL import Image
```
